"use strict";(self.webpackChunktofi=self.webpackChunktofi||[]).push([[285],{7285:(y,h,n)=>{n.r(h),n.d(h,{LoginComponent:()=>F});var c=n(5195),u=n(9157),d=n(2032),g=n(617),l=n(2296),a=n(6223),P=n(8645),m=n(9773),M=n(4716),p=n(2939),i=n(1725),f=n(6007),C=n(6814),t=n(5879),O=n(3866),T=n(4828),b=n(3515);function v(r,E){1&r&&t._UZ(0,"mat-progress-bar",9)}function D(r,E){if(1&r){const e=t.EpF();t.TgZ(0,"mat-form-field",2)(1,"mat-label"),t._uU(2,"\u041a\u043e\u0434"),t.qZA(),t._UZ(3,"input",10),t.TgZ(4,"button",5),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.refreshCode())}),t.TgZ(5,"mat-icon"),t._uU(6,"refresh"),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("formControl",e.twoFactorControl)}}function L(r,E){if(1&r){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.refreshPage())}),t._uU(1,"\u0412\u0432\u0435\u0441\u0442\u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("disabled",e.isLoading)}}let F=(()=>{class r{constructor(e,s,o,_,U,x){this.fb=e,this.authService=s,this.router=o,this.snackBar=_,this.cdr=U,this.showPassword=!1,this.isLoading=!1,this.hasTwoFactor=!1,this.twoFactorControl=this.fb.control(null,[a.kI.required]),this.destroy$$=new P.x,this.authForm=this.fb.group({login:this.fb.control("",[a.kI.required]),password:this.fb.control("",[a.kI.required])}),x.accounts.get$(42).subscribe(console.log)}login(){if(this.authForm.valid){this.isLoading=!0;const e=this.authForm.getRawValue();this.authService.login$(e).pipe((0,m.R)(this.destroy$$),(0,M.x)(()=>{this.isLoading=!1,this.cdr.detectChanges()})).subscribe({next:()=>{this.authService.getUserInfo()?.twoFactor?(this.authForm.get("login")?.disable(),this.authForm.get("password")?.disable(),this.hasTwoFactor=!0,this.snackBar.openFromComponent(i.E,{data:{type:"success",message:"\u041a\u043e\u0434 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u043d\u0430 \u043f\u043e\u0447\u0442\u0443"}})):this.router.navigateByUrl("/")},error:s=>{const o=s.error.error_description.toString();this.snackBar.openFromComponent(i.E,{data:{type:"error",message:o}})}})}else this.authForm.markAllAsTouched();this.twoFactorControl.valid&&this.hasTwoFactor&&this.authService.confirmSMS$({otp_code:this.twoFactorControl.value}).pipe((0,m.R)(this.destroy$$)).subscribe({next:()=>{this.authService.setSMSConfirmed(!0),this.router.navigateByUrl("/")},error:()=>{this.snackBar.openFromComponent(i.E,{data:{type:"error",message:"\u041f\u0440\u043e\u0432\u0435\u0440\u043e\u0447\u043d\u044b\u0439 \u043a\u043e\u0434 \u0443\u043a\u0430\u0437\u0430\u043d \u043d\u0435\u0432\u0435\u0440\u043d\u043e"}})}})}redirectToRegister(){this.hasTwoFactor&&this.authService.handleLogout(),this.router.navigateByUrl("register")}refreshPage(){this.authService.handleLogout(),this.authForm.reset(),this.hasTwoFactor=!1,this.authForm.enable()}refreshCode(){this.authService.refreshSMS$().pipe((0,m.R)(this.destroy$$)).subscribe({next:()=>{this.snackBar.openFromComponent(i.E,{data:{type:"success",message:"\u041a\u043e\u0434 \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d"}})},error:()=>{this.snackBar.openFromComponent(i.E,{data:{type:"warning",message:"\u0421\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043a\u043e\u0434\u0430 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u044f \u043d\u0435 \u0438\u0441\u0442\u0435\u043a"}})}})}ngOnDestroy(){this.destroy$$.next(),this.destroy$$.complete()}static#t=this.\u0275fac=function(s){return new(s||r)(t.Y36(a.qu),t.Y36(O.e),t.Y36(T.F0),t.Y36(p.ux),t.Y36(t.sBO),t.Y36(b.v))};static#o=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-login"]],standalone:!0,features:[t.jDz],decls:22,vars:8,consts:[[3,"formGroup"],["mode","indeterminate",4,"ngIf"],["appearance","outline",1,"form-field-rec"],["matInput","","formControlName","login"],["matInput","","formControlName","password",3,"type"],["mat-icon-button","","matSuffix","",3,"click"],["appearance","outline","class","form-field-rec",4,"ngIf"],["mat-stroked-button","",3,"disabled","click"],["mat-stroked-button","",3,"disabled","click",4,"ngIf"],["mode","indeterminate"],["matInput","","type","number",3,"formControl"]],template:function(s,o){1&s&&(t.TgZ(0,"mat-card",0),t.YNc(1,v,1,0,"mat-progress-bar",1),t.TgZ(2,"h2"),t._uU(3,"Payment system"),t.qZA(),t.TgZ(4,"mat-form-field",2)(5,"mat-label"),t._uU(6,"E-mail"),t.qZA(),t._UZ(7,"input",3),t.qZA(),t.TgZ(8,"mat-form-field",2)(9,"mat-label"),t._uU(10,"\u041f\u0430\u0440\u043e\u043b\u044c"),t.qZA(),t._UZ(11,"input",4),t.TgZ(12,"button",5),t.NdJ("click",function(){return o.showPassword=!o.showPassword}),t.TgZ(13,"mat-icon"),t._uU(14),t.qZA()()(),t.YNc(15,D,7,1,"mat-form-field",6),t.TgZ(16,"mat-card-footer")(17,"button",7),t.NdJ("click",function(){return o.login()}),t._uU(18,"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),t.qZA(),t.TgZ(19,"button",7),t.NdJ("click",function(){return o.redirectToRegister()}),t._uU(20,"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"),t.qZA(),t.YNc(21,L,2,1,"button",8),t.qZA()()),2&s&&(t.Q6J("formGroup",o.authForm),t.xp6(1),t.Q6J("ngIf",o.isLoading),t.xp6(10),t.Q6J("type",o.showPassword?"text":"password"),t.xp6(3),t.Oqu(o.showPassword?"visibility_off":"visibility"),t.xp6(1),t.Q6J("ngIf",o.hasTwoFactor),t.xp6(2),t.Q6J("disabled",o.isLoading),t.xp6(2),t.Q6J("disabled",o.isLoading),t.xp6(2),t.Q6J("ngIf",o.hasTwoFactor))},dependencies:[c.QW,c.a8,c.rt,u.lN,u.KE,u.hX,u.R9,d.c,d.Nt,g.Ps,g.Hw,l.ot,l.lW,l.RK,a.UX,a.Fj,a.wV,a.JJ,a.JL,a.oH,a.sg,a.u,p.ZX,f.Cv,f.pW,C.ez,C.O5],styles:["[_nghost-%COMP%]{display:flex;height:100%;justify-content:center;align-items:center;flex:1 1;animation-name:_ngcontent-%COMP%_fadeIn;animation-duration:.5s}[_nghost-%COMP%]   input[_ngcontent-%COMP%]::-webkit-outer-spin-button, [_nghost-%COMP%]   input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}mat-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:32px 64px;align-items:center}mat-card[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1 1;height:36px;width:100%}mat-card[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;width:100%}mat-card[_ngcontent-%COMP%]   mat-card-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 0;height:32px;flex:1 1;font-size:16px;font-weight:500;letter-spacing:.005em}"],changeDetection:0})}return r})()}}]);